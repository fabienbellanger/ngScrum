<sa-loading *ngIf="loading"></sa-loading>
<div *ngIf="!loading" class="margin-bottom-20px">
    <h1>{{ title }}</h1>

    <form class="form-horizontal" [formGroup]="taskFormGroup" (ngSubmit)="editTask()">
        <div class="row margin-bottom-20px">
            <div class="col-xs-12">
                <button md-raised-button type="button"
                        [routerLink]="['/sprints', sprintId, 'tasks']"
                        [routerLinkActiveOptions]="{exact: false}"
                        routerLinkActive="true">
                    <md-icon>keyboard_arrow_left</md-icon>
                    <span>{{ 'tasks.list' | translate }}</span>
                </button>
                &nbsp;&nbsp;
                <button md-raised-button type="submit"
                        color="primary"
                        [disabled]="taskFormGroup.invalid">
                    <md-icon>add</md-icon>
                    <span>{{ buttonTitle }}</span>
                </button>
            </div>
        </div>

        <md-card>
            <md-card-content>
                <div class="row">
                    <p class="col-xs-12 col-sm-6 col-md-4">
                        <md-input-container class="width-100">
                            <input mdInput type="text" name="name"
                                [placeholder]="'name' | translate"
                                formControlName="name"
                                maxlength="100"
                                autofocus required>
                            <md-hint align="end">{{ taskFormGroup.get('name').value.length }} / 100</md-hint>
                            <md-error *ngIf="taskFormGroup.get('name').hasError('required')">
                                {{ 'required.name' | translate }}
                            </md-error>
                        </md-input-container>
                    </p>
                </div>

                <div class="row">
                    <p class="col-xs-12 col-sm-6 col-md-4">
                        <md-input-container class="width-100">
                            <textarea mdInput mdTextareaAutosize name="description"
                                    [placeholder]="'description' | translate"
                                    [(ngModel)]="description" [ngModelOptions]="{standalone: true}"></textarea>
                        </md-input-container>
                    </p>
                </div>

                <div class="row">
                    <p class="col-xs-12 col-sm-6 col-md-4">
                        <md-input-container class="width-100">
                            <input mdInput type="number" name="duration"
                                min="0.5" max="35" step="0.5"
                                [placeholder]="'duration.in.hour' | translate"
                                formControlName="duration"
                                [readonly]="id !== 0"
                                required>
                            <span mdSuffix>&nbsp;h</span>
                            <md-error *ngIf="taskFormGroup.get('duration').hasError('required')">
                                {{ 'required.duration' | translate }}
                            </md-error>
                        </md-input-container>
                    </p>
                </div>

                <div class="row">
                    <p class="col-xs-12 col-sm-6 col-md-4">
                        <md-checkbox color="primary" name="notPlanned"
                                    [(ngModel)]="notPlanned" [ngModelOptions]="{standalone: true}">
                            {{ 'not.planned' | translate }}
                        </md-checkbox>
                    </p>
                </div>

                <div class="row">
                    <div class="col-xs-12">
                        <div class="bold margin-top-20px">
                            <h4>{{ 'applications' | translate }}</h4>
                        </div>
                        <div class="margin-bottom-20px">
                            <div class="col-xs-12 col-sm-6 col-md-4 no-padding"
                                *ngFor="let application of applications; let index = index">
                                <div class="radio-checkbox">
                                    <md-checkbox color="primary" [name]="'application_' + index" [id]="'application_' + index"
                                                (change)="toggleApplication($event, index, application.id)"
                                                [ngModel]="applicationsIds[index]"
                                                [ngModelOptions]="{standalone: true}">
                                        {{ application.name }}
                                    </md-checkbox>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </md-card-content>

            <md-card-actions>
                <div>
                    <button md-raised-button type="button"
                            [routerLink]="['/sprints', sprintId, 'tasks']"
                            [routerLinkActiveOptions]="{exact: false}"
                            routerLinkActive="true">
                        <md-icon>keyboard_arrow_left</md-icon>
                        <span>{{ 'tasks.list' | translate }}</span>
                    </button>
                    &nbsp;&nbsp;
                    <button md-button type="submit"
                            color="primary"
                            [disabled]="taskFormGroup.invalid">
                        <md-icon>add</md-icon>
                        <span>{{ buttonTitle }}</span>
                    </button>
                </div>
            </md-card-actions>
        </md-card>
    </form>
</div>
