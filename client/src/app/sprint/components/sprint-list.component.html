<sa-loading *ngIf="loading"></sa-loading>
<div *ngIf="!loading" class="SprintsList">
    <h1>{{ 'sprints.list' | translate }}</h1>

    <div class="btn-group" role="group">
        <button md-raised-button (click)="getSprints('inProgress')"
                [color]="(state === 'inProgress') ? 'primary' : ''">
            {{ 'sprint.in.progress.list' | translate }}
        </button>
        &nbsp;&nbsp;
        <button md-raised-button (click)="getSprints('finished')"
                [color]="(state === 'finished') ? 'primary' : ''">
            {{ 'sprint.finished.list' | translate }}
        </button>
        &nbsp;&nbsp;
        <button md-raised-button type="button" color="accent"
                [routerLink]="['/sprints/new']"
                routerLinkActive="true"
                [routerLinkActiveOptions]="{exact: false}">
            {{ 'new.sprint' | translate }}
        </button>
    </div>

    <div class="margin-bottom-20px">
        <md-card class="SprintsList-Sprint"
                 *ngFor="let sprint of sprints"
                 (click)="redirectToTasksManagement(sprint)" sprintHideMenu>
            <md-card-header class="SprintsList-Sprint-Header">
                <md-card-title color="primary" class="SprintsList-Sprint-Header-title">
                    <h4 class="accent-color">{{ sprint.name }}</h4>
                    <div style="display: none">
                        <button md-icon-button [mdMenuTriggerFor]="menu" class="SprintsList-Sprint-Menu"
                                (click)="$event.stopPropagation()">
                            <md-icon>more_vert</md-icon>
                        </button>
                        <md-menu #menu="mdMenu">
                            <button md-menu-item
                                    [routerLink]="['/sprints', sprint.id, 'tasks']"
                                    routerLinkActive="true"
                                    [routerLinkActiveOptions]="{exact: false}">
                                <md-icon>list</md-icon>
                                <span>{{ 'tasks.list' | translate }}</span>
                            </button>
                            <button md-menu-item
                                    [routerLink]="['/sprints', sprint.id, 'statistics']"
                                    routerLinkActive="true"
                                    [routerLinkActiveOptions]="{exact: false}">
                                <md-icon>show_chart</md-icon>
                                <span>{{ 'statistics' | translate }}</span>
                            </button>
                            <button md-menu-item
                                    [routerLink]="['/sprints', sprint.id, 'parameters']"
                                    routerLinkActive="true"
                                    [routerLinkActiveOptions]="{exact: false}">
                                <md-icon>settings</md-icon>
                                <span>{{ 'parameters' | translate }}</span>
                            </button>
                            <button md-menu-item *ngIf="sprint.finishedAt === null"
                                    (click)="deleteSprint(sprint)">
                                <md-icon>delete</md-icon>
                                <span>{{ 'delete' | translate }}</span>
                            </button>
                        </md-menu>
                    </div>
                </md-card-title>
            </md-card-header>

            <md-card-content>
                <div class="list-group-item-text">
                    <div class="row SprintsList-Sprint-info">
                        <div class="SprintsList-Sprint-label">{{ 'created.at' | translate }}</div>
                        <div class="SprintsList-Sprint-value">{{ sprint.createdAt | date:"dd/MM/yyyy" }}</div>
                    </div>
                    <div class="row SprintsList-Sprint-info">
                        <div class="SprintsList-Sprint-label">{{ 'started.at' | translate }}</div>
                        <div class="SprintsList-Sprint-value">{{ sprint.startedAt | date:"dd/MM/yyyy" }}</div>
                    </div>
                    <div class="row SprintsList-Sprint-info">
                        <div class="SprintsList-Sprint-label">{{ 'estimated.end.date' | translate }}</div>
                        <div class="SprintsList-Sprint-value">
                            <span *ngIf="sprint.estimatedFinishedAt !== null">
                                {{ sprint.estimatedFinishedAt | date:"dd/MM/yyyy" }}
                            </span>
                            <span *ngIf="sprint.estimatedFinishedAt === null">-</span>
                        </div>
                    </div>
                    <div class="row SprintsList-Sprint-info" *ngIf="sprint.finishedAt">
                        <div class="SprintsList-Sprint-label">{{ 'finished.at' | translate }}</div>
                        <div class="SprintsList-Sprint-value">{{ sprint.finishedAt | date:"dd/MM/yyyy" }}</div>
                    </div>
                    <div class="row SprintsList-Sprint-info">
                        <div class="SprintsList-Sprint-label">{{ 'remaining.hours' | translate }}</div>
                        <div class="SprintsList-Sprint-value">{{ sprint.remainingDuration | duration:'hour' }}</div>
                    </div>
                    <div class="row SprintsList-Sprint-info">
                        <div class="SprintsList-Sprint-label">{{ 'decrement.hours' | translate }}</div>
                        <div class="SprintsList-Sprint-value">{{ sprint.decrementedDuration | duration:'hour' }}</div>
                    </div>
                    <div class="row SprintsList-Sprint-info">
                        <div class="SprintsList-Sprint-label">{{ 'decrement.hours.per.day' | translate }}</div>
                        <div class="SprintsList-Sprint-value">
                            {{ sprint.decrementedDurationPerDay | duration:'hour' }} / {{ 'day' | translate }}
                        </div>
                    </div>

                    <div class="row margin-bottom-20px margin-top-10px">
                        <div class="col-xs-12 text-center small">
                            <div>{{ sprint.progressPercent | percentFr }}</div>
                            <md-progress-bar [color]="primary"
                                             [mode]="determinate"
                                             [value]="sprint.progressPercent"
                                             [bufferValue]="bufferValue">
                            </md-progress-bar>
                        </div>
                    </div>
                </div>
            </md-card-content>
        </md-card>
        
        <md-card *ngIf="sprints?.length === 0" class="margin-top-20px">
            <md-card-content>
                {{ 'no.sprint' | translate }}
            </md-card-content>
        </md-card>
    </div>
</div>
