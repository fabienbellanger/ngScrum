<sa-loading *ngIf="loading"></sa-loading>
<div *ngIf="!loading" class="SprintsList">
    <h1>{{ 'sprints.list' | translate }}</h1>

    <div class="btn-group" role="group">
        <button md-raised-button (click)="getSprints('inProgress')"
                [color]="(state === 'inProgress') ? 'primary' : ''">
            {{ 'sprint.in.progress.list' | translate }}
        </button>
        &nbsp;&nbsp;
        <button md-raised-button (click)="getSprints('finished')"
                [color]="(state === 'finished') ? 'primary' : ''">
            {{ 'sprint.finished.list' | translate }}
        </button>
        &nbsp;&nbsp;
        <button md-raised-button type="button" color="accent"
                [routerLink]="['/sprints/new']"
                routerLinkActive="true"
                [routerLinkActiveOptions]="{exact: false}">
            <!--<md-icon>add</md-icon>-->
            {{ 'new.sprint' | translate }}
        </button>
    </div>

    <div class="margin-bottom-20px">
        <md-card *ngFor="let sprint of sprints" class="margin-top-20px pointer"
                (click)="redirectToTasksManagement(sprint)">
            <md-card-header>
                <md-card-title>
                    <h4 class="primary-color">
                        {{ sprint.name }}
                    </h4>

                    <button md-mini-fab [mdMenuTriggerFor]="menu" class="SprintsList-Menu"
                            (click)="$event.stopPropagation()">
                        <md-icon>more_vert</md-icon>
                    </button>
                    <md-menu #menu="mdMenu">
                        <button md-menu-item
                                [routerLink]="['/sprints', sprint.id, 'tasks']"
                                routerLinkActive="true"
                                [routerLinkActiveOptions]="{exact: false}">
                            <md-icon>list</md-icon>
                            <span>{{ 'tasks.list' | translate }}</span>
                        </button>
                        <button md-menu-item
                                [routerLink]="['/sprints', sprint.id, 'statistics']"
                                routerLinkActive="true"
                                [routerLinkActiveOptions]="{exact: false}">
                            <md-icon>show_chart</md-icon>
                            <span>{{ 'statistics' | translate }}</span>
                        </button>
                        <button md-menu-item
                                [routerLink]="['/sprints', sprint.id, 'parameters']"
                                routerLinkActive="true"
                                [routerLinkActiveOptions]="{exact: false}">
                            <md-icon>settings</md-icon>
                            <span>{{ 'parameters' | translate }}</span>
                        </button>
                    </md-menu>
                </md-card-title>
            </md-card-header>

            <md-card-content>
                <div class="list-group-item-text">
                    <div class="row SprintsList-Sprint-info">
                        <div class="SprintsList-Sprint-label">{{ 'created.at' | translate }}</div>
                        <div class="SprintsList-Sprint-value">{{ sprint.createdAt | date:"dd/MM/yyyy" }}</div>
                    </div>
                    <div class="row SprintsList-Sprint-info">
                        <div class="SprintsList-Sprint-label">{{ 'started.at' | translate }}</div>
                        <div class="SprintsList-Sprint-value">{{ sprint.startedAt | date:"dd/MM/yyyy" }}</div>
                    </div>
                    <div class="row SprintsList-Sprint-info">
                        <div class="SprintsList-Sprint-label">{{ 'estimated.end.date' | translate }}</div>
                        <div class="SprintsList-Sprint-value">TODO</div>
                    </div>
                    <div class="row SprintsList-Sprint-info" *ngIf="sprint.finishedAt">
                        <div class="SprintsList-Sprint-label">{{ 'finished.at' | translate }}</div>
                        <div class="SprintsList-Sprint-value">{{ sprint.finishedAt | date:"dd/MM/yyyy" }}</div>
                    </div>
                    <div class="row SprintsList-Sprint-info">
                        <div class="SprintsList-Sprint-label">{{ 'remaining.hours' | translate }}</div>
                        <div class="SprintsList-Sprint-value">{{ sprint.remainingDuration | duration:'hour' }}</div>
                    </div>

                    <div class="row margin-bottom-20px margin-top-10px">
                        <div class="col-xs-12 text-center small">
                            <div>{{ sprint.progressPercent | percentFr }}</div>
                            <md-progress-bar [color]="primary"
                                            [mode]="determinate"
                                            [value]="sprint.progressPercent"
                                            [bufferValue]="bufferValue">
                            </md-progress-bar>
                        </div>
                    </div>
                </div>
            </md-card-content>

            <!--<md-card-actions>
                <button md-button type="button" class="md-button-small-width"
                        [routerLink]="['/sprints', sprint.id, 'statistics']"
                        routerLinkActive="true"
                        [routerLinkActiveOptions]="{exact: false}">
                    <span class="fa fa-bar-chart"></span>
                    <span class="hidden-xs">{{ 'statistics' | translate }}</span>
                </button>
                <button md-button type="button"class="md-button-small-width"
                        [routerLink]="['/sprints', sprint.id, 'tasks']"
                        routerLinkActive="true"
                        [routerLinkActiveOptions]="{exact: false}">
                    <span class="fa fa-tasks"></span>
                    <span class="hidden-xs">{{ 'tasks.list' | translate }}</span>
                </button>
                <button md-button type="button"class="md-button-small-width"
                        [routerLink]="['/sprints', sprint.id, 'tasks-management']"
                        routerLinkActive="true"
                        [routerLinkActiveOptions]="{exact: false}">
                    <span class="fa fa-tasks"></span>
                    <span class="hidden-xs">{{ 'tasks.management' | translate }}</span>
                </button>
                <button md-button type="button"class="md-button-small-width"
                        [routerLink]="['/sprints', sprint.id, 'parameters']"
                        routerLinkActive="true"
                        [routerLinkActiveOptions]="{exact: false}">
                    <span class="fa fa-gear"></span>
                    <span class="hidden-xs">{{ 'parameters' | translate }}</span>
                </button>
            </md-card-actions>-->
        </md-card>
    </div>

    <div *ngIf="sprints?.length === 0">
        <md-card>
            <md-card-content>
                {{ 'no.sprint' | translate }}
            </md-card-content>
        </md-card>
    </div>
</div>
